## Visão Geral do Produto
- Descrição concisa  
  ReembolsaJus é um Micro SaaS que permite a advogados autônomos subir extratos bancários em PDF e, por meio de IA, extrair e classificar apenas despesas reembolsáveis (custas, deslocamentos, cartório, GRU, OAB, estacionamento, transportes, etc.), gerando um relatório de cobrança em PDF em poucos minutos.

- Público-alvo  
  Advogados autônomos brasileiros que querem recuperar reembolsos esquecidos, ganhar produtividade e melhorar margem financeira sem investir tempo em conferência manual.

- Proposta de valor única  
  Identificação automática e precisa de gastos reembolsáveis em extratos bancários brasileiros, transformando um processo manual demorado em um fluxo de poucos minutos que gera um relatório pronto para cobrança.

## Requisitos Funcionais
Lista dos requisitos principais, priorizados por MoSCoW.

Must have (essenciais para o MVP)
1. Autenticação: Login/Cadastro simples com Clerk (suporte a e-mail/senha, verificação por e-mail).  
2. Checkout: Integração com Stripe para assinatura mensal (R$ 49) durante o onboarding.  
3. Upload de extrato PDF: Upload via interface web (drag-and-drop e botão de seleção). Limite de 3 uploads/mês por usuário no plano básico. Tamanho máximo por arquivo (ex.: 10 MB).  
4. Processamento inicial (concierge): Backend Node.JS que aceita o PDF, extrai texto (pdf-parse/pdfjs) e, se necessário, fallback para OCR assistido; envio de dados ao motor de IA (OpenRouter/LLM) com prompt especializado para identificar despesas reembolsáveis.  
5. Identificador de Custas (IA): Prompt e pipeline que classificam transações como “Reembolsável” / “Não-Reembolsável” / “Possível — revisar”, extraindo data, valor e descrição. Suporte a padrões brasileiros (Uber, 99, Cartório, OAB, GRU, Tribunais, Estacionamento, Posto, Pedágio).  
6. Tela de Revisão: Lista de itens detectados com colunas Data / Valor / Descrição / Tag detectada / Campo para digitar Nome do Cliente e botão para marcar item como incluído/excluído. Edição inline das descrições.  
7. Geração de Relatório: Botão “Gerar Relatório de Cobrança” que cria e disponibiliza PDF formatado com dados por cliente, totalização e notas. Download imediato.  
8. Segurança & Privacidade: Uploads encriptados em trânsito (TLS) e em repouso (AES-256). Apagar dados sensíveis não-reembolsáveis após processamento; políticas claras de retenção.  
9. Logs de auditoria: Histórico básico de uploads processados (ID, data, status, número de itens reembolsáveis).  
10. Notificações de status: Feedback de upload e processamento (fila, em andamento, concluído, falha).

Should have (importante, não essencial no lançamento inicial, possível no MVP condicionado ao tempo)
1. Skeleton loaders e feedbacks visuais durante o processamento.  
2. Histórico detalhado com reprocessamento manual (concierge) como fallback.  
3. Mensuração de acurácia: possibilidade do usuário marcar itens corretos/incorretos para treinar prompt.  
4. Limite por mês exibido claramente no dashboard com contadores.  
5. Política de redução de movimento (prefers-reduced-motion) nas animações.

Could have (boa para roadmap pós-launch MVP)
1. Exportação CSV/Excel (não incluído no MVP segundo escopo, mas desejável).  
2. Integração Open Finance (não para MVP).  
3. Mobile app nativo (apenas Web responsivo no MVP).  
4. Templates customizáveis de relatório e logomarca do escritório.  
5. Multiusuário e permissões por conta (não no MVP).

Won’t have (explicitamente excluído do MVP)
1. Análise de gastos pessoais.  
2. Gráficos avançados de fluxo de caixa.  
3. Integração automática com ERPs/softwares de gestão agora.  
4. Exportação imediata para CSV/Excel no MVP.  
5. Aplicativo mobile nativo no MVP.

## Histórias de Usuário
- Como Advogado, eu quero me cadastrar e pagar a assinatura para poder usar o serviço.  
- Como Advogado, eu quero fazer upload de um extrato PDF para que o sistema identifique possíveis reembolsos.  
- Como Advogado, eu quero ver uma lista dos itens detectados (data, valor, descrição) para revisar e confirmar quais cobrar.  
- Como Advogado, eu quero digitar o nome do cliente por item (ou em massa) para atribuir as despesas ao cliente correto.  
- Como Advogado, eu quero gerar um relatório de cobrança em PDF para enviar ao cliente ou anexar ao processo.  
- Como Advogado, eu quero limite de 3 uploads/mês no plano básico para controlar o uso conforme o plano.  
- Como Advogado, eu quero receber feedback visual do status do processamento (uploaded → parsing → IA → pronto) para entender o progresso.  
- Como Administrador (operacional MVP - concierge), eu quero ver os uploads pendentes e reprocessar manualmente para garantir precisão inicial.  
- Como Advogado, eu quero apagar permanentemente dados sensíveis não-reembolsáveis após processamento para manter sigilo.

## Estrutura de Páginas/Seções
Hierarquia de navegação (sugerida)
- / (Landing pública)  
- /login, /signup (Clerk)  
- /onboarding/checkout (Stripe)  
- /dashboard (após login)  
  - Uploads recentes / contador do mês  
  - Botão "Novo Upload"  
- /upload (página de upload com drag-and-drop)  
- /review/:uploadId (Tela de revisão dos itens extraídos)  
- /report/:reportId (Visualizar/baixar relatório PDF gerado)  
- /billing (informações de assinatura; cancelar)  
- /account (configurações básicas, segurança, limite de uploads)  
- /admin/concierge (dashboard interno para reprocessamento manual — apenas operacional MVP)

Wireframes em texto para cada página principal

1. Landing
- Header: logo (ReembolsaJus), botão Entrar, botão Assinar (visible CTA).  
- Hero: valor (Recupere custas perdidas em minutos), bullet de benefícios e CTA “Comece por R$49/mês”.  
- Footer: termos, política de privacidade (LGPD), contato.

2. Login / Signup
- Simples form (e-mail, senha) + link para recuperar senha. Após signup, redirecionar para checkout Stripe antes de ativar limite de uploads.

3. Onboarding / Checkout
- Formulário de pagamento Stripe com resumo do plano (R$49/mês), botão Pagar. Após pagamento, criar conta ativa e liberar 3 uploads.

4. Dashboard
- Topbar com avatar, nome, botão Novo Upload.  
- Painel central: contador de uploads usados (ex.: 1/3), lista de uploads recentes com status (Pronto / Em processamento / Falha).  
- CTA destaque “Novo Upload”.

5. Upload (página)
- Área drag-and-drop central (ícone PDF, instrução). Indicar aceite de arquivos e máximo por mês.  
- Ao soltar: animar card de arquivo com progresso (barra) e badge “Enviado”.  
- Após upload: mensagem “Arquivo aceito — processamento em fila” e link para /review/:uploadId quando pronto.

6. Review / Resultado de Análise (core screen)
- Header: nome do arquivo, data, número de itens detectados, total reembolsável.  
- Filtros/Toggle: Mostrar Apenas Reembolsáveis / Todos / Possíveis.  
- Tabela/lista: cada linha = transação com colunas: checkbox (incluir/excluir), Data (editable), Valor (editable monetário), Descrição (texto extraído com destaque dos tokens detectados), Tag (exibido como chip: UBER / CARTÓRIO / GRU / ESTACIONAMENTO / OUTRO), campo inline “Nome do Cliente” (auto-sugestão se múltiplos nomes).  
- Ações em massa: Selecionar todos / Atribuir cliente / Excluir.  
- Botão fixo “Gerar Relatório de Cobrança” (primário).  
- Em caso de incerteza, botão “Marcar para revisão pelo concierge”.

7. Relatório (página/arquivo gerado)
- PDF formatado: cabeçalho com logo (opcional), dados do advogado, lista por cliente (itens, datas, valores), total por cliente, total geral, observações. Botão Download e botão “Enviar por e-mail” (opcional futuro).

8. Billing / Account
- Mostrar plano, próximos faturamentos, botão cancelar/trocar.

9. Admin / Concierge (interno)
- Fila de uploads pendentes, visualizar PDF, reprocessar com prompt refinado, marcar como revisado.

## Design e Interações
Paleta de cores sugerida
- Primária: Azul-profundo #0B4F71 (confiança, jurídico)  
- Acento/CTA: Verde fiscal #29A36C (recuperação financeira)  
- Neutros: Cinza-escuro #222; Cinza-médio #6B7280; Fundo #FAFBFC  
- Erro: Vermelho #E03E3E  
- Sucesso/Badge: Verde-clar0 #DFF6EA

Tipografia
- Titulos: Inter (peso 600/700) — legibilidade e modernidade.  
- Corpo: Roboto / Inter (regular 400).  
- Monospace (valores tabulares): Roboto Mono para alinhamento de valores no PDF se necessário.

Animações e microinterações (detalhadas)
1. Upload Dropzone (microinterações)
   - Hover: leve escala do card (scale 1 → 1.02) e glow de borda (box-shadow) ao arrastar arquivo.  
   - On Drop: morph do ícone PDF para card de progresso (shared element transition).  
   - Implementação técnica: usar Framer Motion layoutId para shared element transition entre dropzone e card de upload; variant hover com scale/box-shadow; duration 160–220ms; easing cubic-bezier(.2,.9,.3,1).  
   - Prefers-reduced-motion: desativar scale e usar mudança instantânea de cor.

2. Progresso de Parsing (estágio: upload → parsing → IA → pronto)
   - Barra de progresso em etapas (3 etapas) com micro-anim: cada etapa acende com slide + fade; ao completar, o step mostra tick animado (bounce).  
   - Implementação técnica: GSAP timeline ou Framer Motion staggered children; animação por etapas com Lottie para tick animado; fallback com CSS animations se Lottie não disponível.

3. Skeleton Rows & Shimmer para lista de itens
   - Enquanto processando, mostrar skeleton rows com shimmer horizontal contínuo.  
   - Técnica: CSS keyframes para shimmer; Framer Motion para fade-in das linhas reais com stagger (staggerChildren: 0.04s).

4. Revelação de Itens Detectados
   - Ao carregar resultados, cada item faz slide-up + fade-in com pequeno delay em cascata (stagger). O chip de tag surge com um scale(0.8→1) e bounce sutil.  
   - Técnica: Framer Motion variants com initial { y:12, opacity:0 } animate { y:0, opacity:1 } transition { type:'spring', stiffness: 300, damping: 22 }.

5. Highlight de tokens na descrição
   - Palavras detectadas (ex.: UBER, GRU, CARTÓRIO) aparecem com um fundo amarelo suave que aparece com flash rápido e se estabiliza (anim fade + scale).  
   - Técnica: Wrap tokens em <mark> com animation via CSS (background-color transition) ou usar Framer Motion para cada token.

6. Botão “Gerar Relatório” → Morph to Processing → Success
   - Clique: botão faz morph para um círculo com spinner (scale + border-radius transition), após geração transforma em tick com confetti Lottie.  
   - Técnica: Framer Motion layout + animate; usar Lottie para confetti; garantir reduced-motion fallback que apenas mostra um modal de sucesso sem confetti.

7. Toasts e feedbacks de erro
   - Toaster no canto superior direito com slide-in/slide-out (250ms) e ícones animados.  
   - Técnica: Headless UI + Framer Motion AnimatePresence para entrada/saída.

Padrões de interação recomendados
- Progressive disclosure: mostrar apenas os itens reembolsáveis por padrão; opção “ver todos” para reduzir carga cognitiva.  
- Inline edit & bulk actions: permitir edição direta dos campos e ação em massa para atribuir clientes rapidamente.  
- Undo rápido: ao excluir um item, mostrar toast com “Desfazer” por 7s.  
- Confirmação leve: passos irreversíveis (apagar conta ou dados) com modal de confirmação e explicação de consequências.  
- Prefers-reduced-motion: respeitar essa configuração do sistema.

Bibliotecas recomendadas
- Autenticação: Clerk.  
- Pagamentos: Stripe (Checkout ou Payment Element).  
- Frontend: React + Vite/Next.js (para SSR/SSG se desejar SEO).  
- Animações: Framer Motion (transições principais, shared element), GSAP (timelines complexas se necessário), Lottie (success/confetti).  
- PDF parsing: pdf-parse, pdfjs-dist (Node).  
- OCR fallback: Tesseract.js (se precisar de OCR em browser) ou Google Vision API (backend).  
- Backend: Node.JS (Express / Fastify), OpenRouter (chamada LLM), multer / direct-to-S3 uploads.  
- Filas / jobs: BullMQ (Redis) para escala — mas MVP pode processar sincronamente com fallback concierge.  
- Gerenciamento de estado: React Query (para fetch/refresh do status de processamento).  
- PDF generation: PDFKit / Puppeteer (render de HTML → PDF para layout do relatório).  
- Infra/storage: S3-compatible (DigitalOcean Spaces / AWS S3) com server-side encryption.

## Considerações Técnicas
Stack tecnológica sugerida
- Frontend: React (Next.js ou Vite) + TypeScript + TailwindCSS (rápido para MVP) + Framer Motion.  
- Backend: Node.js + TypeScript (Fastify/Express) rodando na Replit ou VPS inicial.  
- Storage: S3-compatible (uploads temporários).  
- LLM/IA: OpenRouter para chamada a models (usando prompt com few-shot e temperature baixo para consistência).  
- DB: SQLite para MVP simples ou PostgreSQL se quiser persistência.  
- Jobs: Processamento síncrono/assisted (concierge) inicialmente; migrar para BullMQ com Redis para filas conforme escala.  
- PDF parsing: pdf-parse / pdfjs-dist; OCR fallback: Tesseract.js ou Google Vision.

Integrações necessárias
- Clerk (auth).  
- Stripe (pagamento/assinaturas).  
- OpenRouter (LLM).  
- S3 (storage).  
- Opcional: Google Vision API (OCR) se quiser cobertura ampla de PDFs varridos/imagens.

Requisitos de performance e SLAs (MVP)
- Tempo alvo por processamento: < 90s do upload ao resultado em fluxo totalmente automático; inicialmente processe em até 24h com concierge (validar precisão).  
- Geração de PDF: < 10s para PDFs simples.  
- Uptime: target 99% no lançamento.  
- Taxa de erro: monitorar e manter falso-positivo (classificar como reembolsável indevidamente) abaixo de 15% após ajustes de prompt no concierge.

Segurança, privacidade e conformidade
- Transmissão TLS 1.2+; armazenamento encriptado do arquivo em repouso (AES-256).  
- Minimizar retenção: excluir automaticamente PDFs completos e dados não-reembolsáveis após processamento (recomendar política padrão: dados sensíveis excluídos imediatamente; reembolsáveis mantidos por 30 dias para histórico, configurável).  
- Logs de auditoria com acesso restrito.  
- Política de consentimento e tratamento de dados alinhada à LGPD.  
- Permissões estritas: apenas o usuário pode acessar seus uploads; admin/concierge com dashboard restringido; registrar consentimentos.  
- Rate limits e proteção contra uploads maliciosos (verificação MIME, detecção de payloads).

Métricas e monitoramento
- Conversão: visitantes → trial/assinatura.  
- Retenção: churn mensal.  
- Taxa de conversão do fluxo: upload → relatório gerado.  
- Acurácia IA: precisão/recall de itens reembolsáveis (registro das correções feitas pelo usuário para melhoria de prompt).  
- Tempo médio para relatório gerado.  
- Número de assinaturas pagas (meta inicial 10 em 15 dias).

Regras de negócio críticas
- Limite de 3 uploads/mês no plano básico. Bloquear upload adicional até renovação do ciclo.  
- Contabilizar um upload por arquivo PDF submetido com sucesso para processamento.  
- Política de reembolso: não automática; tratar caso a caso.  
- Dados sensíveis descartados conforme política de retenção.

## Roadmap Sugerido
MVP (Fase 1 — 7 dias úteis; lançamento concierge)
- Core:
  - Implementar autenticação com Clerk e onboarding com Stripe checkout.  
  - Upload de PDF (drag-and-drop), armazenamento temporário em S3.  
  - Backend Node.JS com pipeline de extração de texto (pdf-parse) + chamada ao OpenRouter com prompt treinado (few-shot) para identificação de custas.  
  - Tela de Revisão: lista de itens detectados (data, valor, descrição), edição inline e campo Nome do Cliente.  
  - Geração de relatório PDF via HTML → PDF (Puppeteer) e download.  
  - Limite de 3 uploads/mês visível no dashboard.  
  - Concierging: processamento assistido manualmente por operador para validação da acurácia nas primeiras semanas.  
  - Métricas básicas: contadores de uploads, assinaturas, relatórios gerados, tempo de processamento.  
  - Segurança básica (TLS, encriptação em repouso, política de exclusão simples).

Melhorias futuras (Fase 2 — próximo trimestre)
- Automatizar completamente o processamento (remover dependência de concierge) e otimizar prompts com base em dados reais.  
- Adicionar feedback do usuário como sinal para retrain/ajuste de prompt (correções que alimentam tuning).  
- Implementar OCR robusto (Google Vision ou Tesseract server-side) para PDFs scaneados.  
- Exportação CSV/Excel e templates de relatório customizáveis.  
- UI/UX refinements: sugestões automáticas de cliente, melhores filtros, pesquisa por termo.  
- Implementar fila (BullMQ) e workers escaláveis para processamentos concorrentes.  
- Painel de administração com métricas operacionais e logs.  
- Políticas de retenção configuráveis no painel.

Visão de longo prazo (Fase 3)
- Integrações avançadas: Open Finance / integração com ERPs e softwares jurídicos (para lançar ligações automáticas de cobrança ao processo).  
- Multiusuário/conta corporativa com permissões e histórico por usuário.  
- Machine learning pipeline proprietária para classificação (modelo finetuned) com métricas automatizadas de qualidade e auto-tuning.  
- Relatórios financeiros e painéis com gráficos de reaplicação de reembolsos, previsão de renda recuperada e ROI detalhado.  
- App mobile nativo para upload rápido no local (foto do extrato), notificações push e workflow mobile-first.